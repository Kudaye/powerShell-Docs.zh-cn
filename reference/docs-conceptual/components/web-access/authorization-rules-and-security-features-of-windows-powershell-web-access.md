---
ms.date: 06/27/2017
keywords: powershell,cmdlet
title: Windows PowerShell Web 访问的授权规则和安全功能
ms.openlocfilehash: ee25df052994e47e559daa87b89af813471d896b
ms.sourcegitcommit: 6545c60578f7745be015111052fd7769f8289296
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/22/2020
ms.locfileid: "81624748"
---
# <a name="authorization-rules-and-security-features-of-windows-powershell-web-access"></a><span data-ttu-id="79eaa-103">Windows PowerShell Web 访问的授权规则和安全功能</span><span class="sxs-lookup"><span data-stu-id="79eaa-103">Authorization Rules and Security Features of Windows PowerShell Web Access</span></span>

<span data-ttu-id="79eaa-104">更新时间：2013 年 6 月 24 日</span><span class="sxs-lookup"><span data-stu-id="79eaa-104">Updated: June 24, 2013</span></span>

<span data-ttu-id="79eaa-105">适用于：Windows Server 2012 R2、Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="79eaa-105">Applies To: Windows Server 2012 R2, Windows Server 2012</span></span>

<span data-ttu-id="79eaa-106">在 Windows Server 2012 R2 和 Windows Server 2012 中的 Windows PowerShell Web 访问具有受限的安全模型。</span><span class="sxs-lookup"><span data-stu-id="79eaa-106">Windows PowerShell Web Access in Windows Server 2012 R2 and Windows Server 2012 has a restrictive security model.</span></span> <span data-ttu-id="79eaa-107">必须向用户显式授予访问权限，他们才能登录 Windows PowerShell Web 访问网关和使用基于 Web 的 Windows PowerShell 控制台。</span><span class="sxs-lookup"><span data-stu-id="79eaa-107">Users must explicitly be granted access before they can sign in to the Windows PowerShell Web Access gateway and use the web-based Windows PowerShell console.</span></span>

## <a name="configuring-authorization-rules-and-site-security"></a><span data-ttu-id="79eaa-108">配置授权规则和站点安全</span><span class="sxs-lookup"><span data-stu-id="79eaa-108">Configuring authorization rules and site security</span></span>

<span data-ttu-id="79eaa-109">安装 Windows PowerShell Web 访问和配置网关后，用户可在浏览器中打开登录页面，但他们无法登录，直到 Windows PowerShell Web 访问管理员明确授予用户访问权限。</span><span class="sxs-lookup"><span data-stu-id="79eaa-109">After Windows PowerShell Web Access is installed and the gateway is configured, users can open the sign-in page in a browser, but they cannot sign in until the Windows PowerShell Web Access administrator grants users access explicitly.</span></span> <span data-ttu-id="79eaa-110">Windows PowerShell Web 访问的访问控制通过使用下表所述的一组 Windows PowerShell cmdlet 进行管理。</span><span class="sxs-lookup"><span data-stu-id="79eaa-110">'Windows PowerShell Web Access' access control is managed by using the set of Windows PowerShell cmdlets described in the following table.</span></span> <span data-ttu-id="79eaa-111">没有相当的 GUI 可用于添加或管理授权规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-111">There is no comparable GUI for adding or managing authorization rules.</span></span>
<span data-ttu-id="79eaa-112">请参阅 [Windows PowerShell Web 访问 Cmdlet](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps)。</span><span class="sxs-lookup"><span data-stu-id="79eaa-112">See [Windows PowerShell Web Access Cmdlets](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps).</span></span>

<span data-ttu-id="79eaa-113">管理员可为 Windows PowerShell Web 访问定义 `{0-n}` 条身份验证规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-113">Administrators can define `{0-n}` authentication rules for Windows PowerShell Web Access.</span></span> <span data-ttu-id="79eaa-114">默认的安全性较为严格，而非宽松；零条身份验证规则意味着无用户可访问任何内容。</span><span class="sxs-lookup"><span data-stu-id="79eaa-114">The default security is restrictive rather than permissive; zero authentication rules means no users have access to anything.</span></span>

<span data-ttu-id="79eaa-115">Windows Server 2012 R2 中的 [Add-PswaAuthorizationRule](/powershell/module/powershellwebaccess/add-pswaauthorizationrule?view=winserver2012r2-ps) 和 [Test-PswaAuthorizationRule](/powershell/module/powershellwebaccess/test-pswaauthorizationrule?view=winserver2012r2-ps) 包含一个 Credential 参数，该参数使你可从远程计算机或在活动的 Windows PowerShell Web 访问会话中添加和测试 Windows PowerShell Web 访问授权规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-115">[Add-PswaAuthorizationRule](/powershell/module/powershellwebaccess/add-pswaauthorizationrule?view=winserver2012r2-ps) and [Test-PswaAuthorizationRule](/powershell/module/powershellwebaccess/test-pswaauthorizationrule?view=winserver2012r2-ps) in Windows Server 2012 R2 include a Credential parameter that allows you to add and test Windows PowerShell Web Access authorization rules from a remote computer, or from within an active Windows PowerShell Web Access session.</span></span> <span data-ttu-id="79eaa-116">与其他具有 Credential 参数的 Windows PowerShell cmdlet 一样，你可以指定一个 PSCredential 对象作为该参数的值。</span><span class="sxs-lookup"><span data-stu-id="79eaa-116">As with other Windows PowerShell cmdlets that have a Credential parameter, you can specify a PSCredential object as the value of the parameter.</span></span> <span data-ttu-id="79eaa-117">若要创建一个包含要传递到远程计算机的凭据的 PSCredential 对象，请运行 [Get-Credential](/powershell/module/microsoft.powershell.security/Get-Credential) cmdlet。</span><span class="sxs-lookup"><span data-stu-id="79eaa-117">To create a PSCredential object that contains credentials you want to pass to a remote computer, run the [Get-Credential](/powershell/module/microsoft.powershell.security/Get-Credential) cmdlet.</span></span>

<span data-ttu-id="79eaa-118">Windows PowerShell Web 访问身份验证规则是允许列表规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-118">Windows PowerShell Web Access authentication rules are whitelist rules.</span></span> <span data-ttu-id="79eaa-119">每条规则定义了用户、目标计算机和特定的 Windows PowerShell [会话配置](/powershell/module/microsoft.powershell.core/about/about_session_configurations?view=powershell-5.1)（_也称作终结点或运行空间_）在特定目标计算机上的允许连接。</span><span class="sxs-lookup"><span data-stu-id="79eaa-119">Each rule is a definition of an allowed connection between users, target computers, and particular Windows PowerShell [session configurations](/powershell/module/microsoft.powershell.core/about/about_session_configurations?view=powershell-5.1) (also referred to as endpoints or _runspaces_) on specified target computers.</span></span>
<span data-ttu-id="79eaa-120">有关运行空间的说明，请参阅 [Beginning Use of PowerShell Runspaces](https://blogs.technet.microsoft.com/heyscriptingguy/2015/11/26/beginning-use-of-powershell-runspaces-part-1/)（PowerShell 运行空间入门） </span><span class="sxs-lookup"><span data-stu-id="79eaa-120">For an explanation on **runspaces** see [Beginning Use of PowerShell Runspaces](https://blogs.technet.microsoft.com/heyscriptingguy/2015/11/26/beginning-use-of-powershell-runspaces-part-1/)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="79eaa-121">用户仅需要一条可访问的规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-121">A user needs only one rule to be true to get access.</span></span> <span data-ttu-id="79eaa-122">如果用户有权从基于 Web 的控制台访问一台具有所有语言访问权限或仅可访问 Windows PowerShell 远程管理 cmdlet 的计算机，用户可登录（或跳到）其他与第一台目标计算机连接的计算机。</span><span class="sxs-lookup"><span data-stu-id="79eaa-122">If a user is given access to one computer with either full language access or access only to Windows PowerShell remote management cmdlets, from the web-based console, the user can log on (or hop) to other computers that are connected to the first target computer.</span></span> <span data-ttu-id="79eaa-123">配置 Windows PowerShell Web 访问的最安全方法是仅允许用户访问受限制的会话配置，从而可让用户完成他们通常需要远程执行的特定任务。</span><span class="sxs-lookup"><span data-stu-id="79eaa-123">The most secure way to configure Windows PowerShell Web Access is to allow users access only to constrained session configurations that allow them to accomplish specific tasks that they normally need to perform remotely.</span></span>

<span data-ttu-id="79eaa-124">[Windows PowerShell Web 访问 Cmdlet](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps)中引用的 cmdlet 可用于创建一组访问规则，供授权 Windows PowerShell Web 访问网关上的用户时使用。</span><span class="sxs-lookup"><span data-stu-id="79eaa-124">The cmdlets referenced in [Windows PowerShell Web Access Cmdlets](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps) allow to create a set of access rules which are used to authorize a user on the Windows PowerShell Web Access gateway.</span></span> <span data-ttu-id="79eaa-125">规则与目标计算机上的访问控制列表 (ACL) 有所不同，它提高了 Web 访问的安全性。</span><span class="sxs-lookup"><span data-stu-id="79eaa-125">The rules are different from the access control lists (ACLs) on the destination computer, and provide an additional layer of security for web access.</span></span> <span data-ttu-id="79eaa-126">有关安全性的详细信息如以下部分所述。</span><span class="sxs-lookup"><span data-stu-id="79eaa-126">More details about security are described in the following section.</span></span>

<span data-ttu-id="79eaa-127">如果用户无法通过任一上述的安全层，则会在浏览器窗口中看到一条常规的“拒绝访问”消息。</span><span class="sxs-lookup"><span data-stu-id="79eaa-127">If users cannot pass any of the preceding security layers, they receive a generic 'access denied' message in their browser windows.</span></span> <span data-ttu-id="79eaa-128">虽然有关安全性的详细信息记录在网关服务器上，但是最终用户并不获得有关他们通过多少个安全层或无法在哪个安全层登录或身份验证的信息。</span><span class="sxs-lookup"><span data-stu-id="79eaa-128">Although security details are logged on the gateway server, end users are not shown information about how many security layers they passed, or at which layer the sign-in or authentication failure occurred.</span></span>

<span data-ttu-id="79eaa-129">有关如何配置授权规则的详细信息，请参阅本主题中的[配置授权规则](#configuring-authorization-rules-and-site-security)。</span><span class="sxs-lookup"><span data-stu-id="79eaa-129">For more information about configuring authorization rules, see [configuring authorization rules](#configuring-authorization-rules-and-site-security) in this topic.</span></span>

### <a name="security"></a><span data-ttu-id="79eaa-130">安全性</span><span class="sxs-lookup"><span data-stu-id="79eaa-130">Security</span></span>

<span data-ttu-id="79eaa-131">Windows PowerShell Web 访问安全模型在基于 Web 控制台的最终用户和目标计算机之间具有四个安全层。</span><span class="sxs-lookup"><span data-stu-id="79eaa-131">The Windows PowerShell Web Access security model has four layers between an end user of the web-based console, and a target computer.</span></span> <span data-ttu-id="79eaa-132">Windows PowerShell Web 访问管理员可通过其它配置在 IIS 管理器控制台中添加安全层。</span><span class="sxs-lookup"><span data-stu-id="79eaa-132">Windows PowerShell Web Access administrators can add security layers through additional configuration in the IIS Manager console.</span></span> <span data-ttu-id="79eaa-133">有关如何确保 IIS 管理器控制台中网站安全的详细信息，请参阅[配置 Web 服务器安全 (IIS7)](https://technet.microsoft.com/library/cc731278)。</span><span class="sxs-lookup"><span data-stu-id="79eaa-133">For more information about securing websites in the IIS Manager console, see [Configure Web Server Security (IIS7)](https://technet.microsoft.com/library/cc731278).</span></span>

<span data-ttu-id="79eaa-134">有关 IIS 最佳做法和阻止拒绝服务攻击的详细信息，请参阅[阻止 DoS/拒绝服务攻击的最佳做法](https://technet.microsoft.com/library/cc750213)。</span><span class="sxs-lookup"><span data-stu-id="79eaa-134">For more information about IIS best practices and preventing denial-of-service attacks, see [Best Practices for Preventing DoS/Denial of Service Attacks](https://technet.microsoft.com/library/cc750213).</span></span>
<span data-ttu-id="79eaa-135">管理员还可购买和安装其他零售身份验证软件。</span><span class="sxs-lookup"><span data-stu-id="79eaa-135">An administrator can also buy and install additional retail authentication software.</span></span>

<span data-ttu-id="79eaa-136">下表描述最终用户与目标计算机之间的四个安全层。</span><span class="sxs-lookup"><span data-stu-id="79eaa-136">The following table describes the four layers of security between end users and target computers.</span></span>

|<span data-ttu-id="79eaa-137">级别</span><span class="sxs-lookup"><span data-stu-id="79eaa-137">Level</span></span>|<span data-ttu-id="79eaa-138">层</span><span class="sxs-lookup"><span data-stu-id="79eaa-138">Layer</span></span>|
|-|-|
|<span data-ttu-id="79eaa-139">1</span><span class="sxs-lookup"><span data-stu-id="79eaa-139">1</span></span>|[<span data-ttu-id="79eaa-140">IIS Web 服务器安全功能</span><span class="sxs-lookup"><span data-stu-id="79eaa-140">iis web server security features</span></span>](#iis-web-server-security-features)|
|<span data-ttu-id="79eaa-141">2</span><span class="sxs-lookup"><span data-stu-id="79eaa-141">2</span></span>|[<span data-ttu-id="79eaa-142">Windows PowerShell Web 访问基于表单的网关身份验证</span><span class="sxs-lookup"><span data-stu-id="79eaa-142">windows powershell web access forms-based gateway authentication</span></span>](#windows-powershell-web-access-forms-based-gateway-authentication)|
|<span data-ttu-id="79eaa-143">3</span><span class="sxs-lookup"><span data-stu-id="79eaa-143">3</span></span>|[<span data-ttu-id="79eaa-144">Windows PowerShell Web 访问授权规则</span><span class="sxs-lookup"><span data-stu-id="79eaa-144">windows powershell web access authorization rules</span></span>](#windows-powershell-web-access-authorization-rules)|
|<span data-ttu-id="79eaa-145">4</span><span class="sxs-lookup"><span data-stu-id="79eaa-145">4</span></span>|[<span data-ttu-id="79eaa-146">目标身份验证和授权规则</span><span class="sxs-lookup"><span data-stu-id="79eaa-146">target authentication and authorization rules</span></span>](#target-authentication-and-authorization-rules)|

<span data-ttu-id="79eaa-147">有关各层的详细信息，可参阅下列标题：</span><span class="sxs-lookup"><span data-stu-id="79eaa-147">Detailed information about each layer can be found under the following headings:</span></span>

#### <a name="iis-web-server-security-features"></a><span data-ttu-id="79eaa-148">IIS Web 服务器安全功能</span><span class="sxs-lookup"><span data-stu-id="79eaa-148">IIS Web Server security features</span></span>

<span data-ttu-id="79eaa-149">Windows PowerShell Web 访问用户必须始终提供用户名和密码，以对其在网关上的帐户进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="79eaa-149">Windows PowerShell Web Access users must always provide a user name and password to authenticate their accounts on the gateway.</span></span> <span data-ttu-id="79eaa-150">但是，Windows PowerShell Web 访问管理员还可打开或关闭可选的客户端证书身份验证（要了解如何启用测试证书，以及随后如何配置正版证书，请参阅[安装和使用 Windows PowerShell Web 访问](install-and-use-windows-powershell-web-access.md)）。</span><span class="sxs-lookup"><span data-stu-id="79eaa-150">However, Windows PowerShell Web Access administrators can also turn optional client certificate authentication on or off, see [install and use windows powershell web access](install-and-use-windows-powershell-web-access.md) to enable a test certificate and, later, how to configure a genuine certificate).</span></span>

<span data-ttu-id="79eaa-151">可选的客户端证书功能要求最终用户除拥有其用户名和密码外，还须持有有效的客户端证书，这是 Web 服务器 (IIS) 配置的一部分。</span><span class="sxs-lookup"><span data-stu-id="79eaa-151">The optional client certificate feature requires end users to have a valid client certificate, in addition to their user names and passwords, and is part of Web Server (IIS) configuration.</span></span> <span data-ttu-id="79eaa-152">当启用客户端证书层时，Windows PowerShell Web 访问登录页面将提示用户提供有效的证书，然后再评估用户的登录凭据。</span><span class="sxs-lookup"><span data-stu-id="79eaa-152">When the client certificate layer is enabled, the Windows PowerShell Web Access sign-in page prompts users to provide valid certificates before their sign-in credentials are evaluated.</span></span> <span data-ttu-id="79eaa-153">客户端证书身份验证程序自动检查客户端证书。</span><span class="sxs-lookup"><span data-stu-id="79eaa-153">Client certificate authentication automatically checks for the client certificate.</span></span> <span data-ttu-id="79eaa-154">如果找不到有效的证书，Windows PowerShell Web 访问会通知用户，以便用户提供证书。</span><span class="sxs-lookup"><span data-stu-id="79eaa-154">If a valid certificate is not found, Windows PowerShell Web Access informs users, so they can provide the certificate.</span></span> <span data-ttu-id="79eaa-155">如果找到有效的证书，Windows PowerShell Web 访问将为用户打开登录页面，以提供用户名和密码。</span><span class="sxs-lookup"><span data-stu-id="79eaa-155">If a valid client certificate is found, Windows PowerShell Web Access opens the sign-in page for users to provide their user names and passwords.</span></span>

<span data-ttu-id="79eaa-156">这是 IIS Web 服务器提供其他安全设置的示例之一。</span><span class="sxs-lookup"><span data-stu-id="79eaa-156">This is one example of additional security settings that are offered by IIS Web Server.</span></span> <span data-ttu-id="79eaa-157">有关其他 IIS 安全功能的详细信息，请参阅[配置 Web 服务器安全性 (IIS 7)](https://technet.microsoft.com/library/cc731278)。</span><span class="sxs-lookup"><span data-stu-id="79eaa-157">For more information about other IIS security features, see [Configure Web Server Security (IIS 7)](https://technet.microsoft.com/library/cc731278).</span></span>

#### <a name="windows-powershell-web-access-forms-based-gateway-authentication"></a><span data-ttu-id="79eaa-158">Windows PowerShell Web 访问基于表单的网关身份验证</span><span class="sxs-lookup"><span data-stu-id="79eaa-158">Windows PowerShell Web Access forms-based gateway authentication</span></span>

<span data-ttu-id="79eaa-159">Windows PowerShell Web 访问登录页面需要一组凭据（用户名和密码），并向用户提供一个为目标计算机提供其他凭据的选项。</span><span class="sxs-lookup"><span data-stu-id="79eaa-159">The Windows PowerShell Web Access sign-in page requires a set of credentials (user name and password) and offers users the option of providing different credentials for the target computer.</span></span>
<span data-ttu-id="79eaa-160">如果用户不提供备用凭据，则照样可使用连接网关时所用的主要用户名和密码，连接目标计算机。</span><span class="sxs-lookup"><span data-stu-id="79eaa-160">If the user does not provide alternate credentials, the primary user name and password that are used to connect to the gateway are also used to connect to the target computer.</span></span>

<span data-ttu-id="79eaa-161">在 Windows PowerShell Web 访问网关上对所需的凭据进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="79eaa-161">The required credentials are authenticated on the Windows PowerShell Web Access gateway.</span></span> <span data-ttu-id="79eaa-162">这些凭据必须是本地 Windows PowerShell Web 访问网关服务器或 Active Directory 中有效的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="79eaa-162">These credentials must be valid user accounts on either the local Windows PowerShell Web Access gateway server, or in Active Directory.</span></span>

#### <a name="windows-powershell-web-access-authorization-rules"></a><span data-ttu-id="79eaa-163">Windows PowerShell Web 访问授权规则</span><span class="sxs-lookup"><span data-stu-id="79eaa-163">Windows PowerShell Web Access authorization rules</span></span>

<span data-ttu-id="79eaa-164">用户在网关上通过身份验证后，Windows PowerShell Web 访问将检查授权规则，以验证用户是否有权访问所需的目标计算机。</span><span class="sxs-lookup"><span data-stu-id="79eaa-164">After a user is authenticated at the gateway, Windows PowerShell Web Access checks authorization rules to verify if the user has access to the requested target computer.</span></span> <span data-ttu-id="79eaa-165">成功授权后，用户的凭据将传递到目标计算机。</span><span class="sxs-lookup"><span data-stu-id="79eaa-165">After successful authorization, the user's credentials are passed along to the target computer.</span></span>

<span data-ttu-id="79eaa-166">仅当用户通过网关的身份验证之后，以及用户在目标计算机上通过身份验证之前，评估这些规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-166">These rules are evaluated only after a user has been authenticated by the gateway, and before a user can be authenticated on a target computer.</span></span>

#### <a name="target-authentication-and-authorization-rules"></a><span data-ttu-id="79eaa-167">目标身份验证和授权规则</span><span class="sxs-lookup"><span data-stu-id="79eaa-167">Target authentication and authorization rules</span></span>

<span data-ttu-id="79eaa-168">Windows PowerShell Web 访问的最后安全层是目标计算机自身的安全配置。</span><span class="sxs-lookup"><span data-stu-id="79eaa-168">The final layer of security for Windows PowerShell Web Access is the target computer's own security configuration.</span></span> <span data-ttu-id="79eaa-169">用户必须持有在目标计算机上配置的适当访问权限，并且按照 Windows PowerShell Web 访问授权规则，运行通过 Windows PowerShell Web 访问影响目标计算机的 Windows PowerShell 基于 Web 的控制台。</span><span class="sxs-lookup"><span data-stu-id="79eaa-169">Users must have the appropriate access rights configured on the target computer, and also in the Windows PowerShell Web Access authorization rules, to run a Windows PowerShell web-based console that affects a target computer through Windows PowerShell Web Access.</span></span>

<span data-ttu-id="79eaa-170">该层提供相同的安全机制；如果用户尝试通过运行 [Enter-PSSession](/powershell/module/microsoft.powershell.core/Enter-PSSession) 或 [New-PSSession](/powershell/module/microsoft.powershell.core/new-pssession) cmdlet，为 Windows PowerShell 中的目标计算机创建远程 Windows PowerShell 会话，此类机制将评估连接尝试。</span><span class="sxs-lookup"><span data-stu-id="79eaa-170">This layer offers the same security mechanisms that would evaluate connection attempts if users tried to create a remote Windows PowerShell session to a target computer from within Windows PowerShell by running the [Enter-PSSession](/powershell/module/microsoft.powershell.core/Enter-PSSession) or [New-PSSession](/powershell/module/microsoft.powershell.core/new-pssession) cmdlets.</span></span>

<span data-ttu-id="79eaa-171">默认情况下，Windows PowerShell Web 访问使用主要用户名和密码，在网关和目标计算机上进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="79eaa-171">By default, Windows PowerShell Web Access uses the primary user name and password for authentication on both the gateway and the target computer.</span></span> <span data-ttu-id="79eaa-172">在标题为**可选的连接设置**部分，基于 Web 的登录页面为用户提供一个为目标计算机提供其他凭据的选项（如有必要）。</span><span class="sxs-lookup"><span data-stu-id="79eaa-172">The web-based sign-in page, in a section titled **Optional connection settings**, offers users the option of providing different credentials for the target computer, if they are required.</span></span> <span data-ttu-id="79eaa-173">如果用户不提供备用凭据，则照样可使用连接网关时所用的主要用户名和密码，连接目标计算机。</span><span class="sxs-lookup"><span data-stu-id="79eaa-173">If the user does not provide alternate credentials, the primary user name and password that are used to connect to the gateway are also used to connect to the target computer.</span></span>

<span data-ttu-id="79eaa-174">授权规则可让用户访问特定的会话配置。</span><span class="sxs-lookup"><span data-stu-id="79eaa-174">Authorization rules can be used to allow users access to a particular session configuration.</span></span> <span data-ttu-id="79eaa-175">可以为 Windows PowerShell Web 访问创建受限的运行空间  或会话配置，并可让特定用户在登录到 Windows PowerShell Web 访问时仅连接到特定的会话配置。</span><span class="sxs-lookup"><span data-stu-id="79eaa-175">You can create _restricted runspaces_ or session configurations for Windows PowerShell Web Access, and allow specific users to connect only to specific session configurations when they sign in to Windows PowerShell Web Access.</span></span> <span data-ttu-id="79eaa-176">你可使用访问控制列表 (ACL) 确定哪个用户具有访问特定终结点的权限，并使用本部分中的授权规则进一步限制特定用户组合访问终结点的权限。</span><span class="sxs-lookup"><span data-stu-id="79eaa-176">You can use access control lists (ACLs) to determine which users have access to specific endpoints, and further restrict access to the endpoint for a specific set of users by using authorization rules described in this section.</span></span> <span data-ttu-id="79eaa-177">有关受限运行空间的详细信息，请参阅 [Creating a constrained runspace](/powershell/scripting/developer/hosting/creating-a-constrained-runspace)（创建受限运行空间）。</span><span class="sxs-lookup"><span data-stu-id="79eaa-177">For more information about restricted runspaces, see [Creating a constrained runspace](/powershell/scripting/developer/hosting/creating-a-constrained-runspace).</span></span>

### <a name="configuring-authorization-rules"></a><span data-ttu-id="79eaa-178">配置授权规则</span><span class="sxs-lookup"><span data-stu-id="79eaa-178">Configuring authorization rules</span></span>

<span data-ttu-id="79eaa-179">管理员可能想对为了进行 Windows PowerShell 远程管理已在其环境中定义的 Windows PowerShell Web 访问用户执行相同的授权规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-179">Administrators likely want the same authorization rule for Windows PowerShell Web Access users that is already defined in their environment for Windows PowerShell remote management.</span></span> <span data-ttu-id="79eaa-180">本部分中的第一个程序描述如何添加安全授权规则，此类规则可授予一名用户访问权限，以便用户登录并管理一台计算机，以及处于单个会话配置中。</span><span class="sxs-lookup"><span data-stu-id="79eaa-180">The first procedure in this section describes how to add a secure authorization rule that grants access to one user, signing in to manage one computer, and within a single session configuration.</span></span> <span data-ttu-id="79eaa-181">第二个程序描述如何删除不再需要的授权规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-181">The second procedure describes how to remove an authorization rule that is no longer needed.</span></span>

<span data-ttu-id="79eaa-182">如果你计划使用自定义会话配置以允许特定用户仅在 Windows PowerShell Web 访问的限制运行空间中运行，则创建自定义会话配置，然后再添加参考其的授权规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-182">If you plan to use custom session configurations to allow specific users to work only within restricted runspaces in Windows PowerShell Web Access, create your custom session configurations before you add authorization rules that refer to them.</span></span> <span data-ttu-id="79eaa-183">无法使用 Windows PowerShell Web 访问 cmdlet 创建自定义会话配置。</span><span class="sxs-lookup"><span data-stu-id="79eaa-183">You cannot use the Windows PowerShell Web Access cmdlets to create custom session configurations.</span></span> <span data-ttu-id="79eaa-184">有关创建自定义会话配置的详细信息，请参阅 [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files)。</span><span class="sxs-lookup"><span data-stu-id="79eaa-184">For more information about creating custom session configurations, see [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files).</span></span>

<span data-ttu-id="79eaa-185">Windows PowerShell Web 访问 cmdlet 支持一个通配符，即星号 ( \* )。</span><span class="sxs-lookup"><span data-stu-id="79eaa-185">Windows PowerShell Web Access cmdlets support one wildcard character, an asterisk ( \* ).</span></span> <span data-ttu-id="79eaa-186">字符串中的通配符不受支持；根据属性（用户、计算机或会话配置）使用单个星号。</span><span class="sxs-lookup"><span data-stu-id="79eaa-186">Wildcard characters within strings are not supported; use a single asterisk per property (users, computers, or session configurations).</span></span>

> [!NOTE]
> <span data-ttu-id="79eaa-187">有关使用授权规则授予用户访问权限以及帮助确保 Windows PowerShell Web 访问环境安全的更多方式，请参阅本主题中的[其他授权规则方案示例](#other-authorization-rule-scenario-examples)。</span><span class="sxs-lookup"><span data-stu-id="79eaa-187">For more ways you can use authorization rules to grant access to users and help secure the Windows PowerShell Web Access environment, see [other authorization rule scenario examples](#other-authorization-rule-scenario-examples) in this topic.</span></span>

#### <a name="to-add-a-restrictive-authorization-rule"></a><span data-ttu-id="79eaa-188">添加受限的授权规则</span><span class="sxs-lookup"><span data-stu-id="79eaa-188">To add a restrictive authorization rule</span></span>

1. <span data-ttu-id="79eaa-189">使用提升的用户权限执行以下操作之一打开 Windows PowerShell 会话。</span><span class="sxs-lookup"><span data-stu-id="79eaa-189">Do one of the following to open a Windows PowerShell session with elevated user rights.</span></span>

   - <span data-ttu-id="79eaa-190">在 Windows 桌面上，右键单击任务栏上的**Windows PowerShell**，然后单击**以管理员身份运行**。</span><span class="sxs-lookup"><span data-stu-id="79eaa-190">On the Windows desktop, right-click **Windows PowerShell** on the taskbar, and then click **Run as Administrator**.</span></span>

   - <span data-ttu-id="79eaa-191">在 Windows **开始**屏幕上，右键单击**Windows PowerShell**，然后单击**以管理员身份运行**。</span><span class="sxs-lookup"><span data-stu-id="79eaa-191">On the Windows **Start** screen, right-click **Windows PowerShell**, and then click **Run as Administrator**.</span></span>

2. <span data-ttu-id="79eaa-192">使用会话配置限制用户访问的可选步骤： </span><span class="sxs-lookup"><span data-stu-id="79eaa-192">**Optional step** For restricting user access by using session configurations:</span></span>

   <span data-ttu-id="79eaa-193">确保规则中已存在要使用的会话配置。</span><span class="sxs-lookup"><span data-stu-id="79eaa-193">Verify that the session configurations that you want to use, already exist in your rules .</span></span>

   <span data-ttu-id="79eaa-194">如果尚未创建这些配置，则使用 [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files) 中用于创建会话配置的说明。</span><span class="sxs-lookup"><span data-stu-id="79eaa-194">If they have not yet been created, use instructions for creating session configurations in [about_Session_Configuration_Files](/powershell/module/microsoft.powershell.core/about/about_session_configuration_files).</span></span>

3. <span data-ttu-id="79eaa-195">本授权规则允许特定用户通过他们通常访问的网络访问一台计算机，以及可让特定用户拥有对满足用户常见脚本和 cmdlet 需求的特定会话配置的权限。</span><span class="sxs-lookup"><span data-stu-id="79eaa-195">This authorization rule allows a specific user access to one computer on the network to which they typically have access, with access to a specific session configuration that is scoped to the user's typical scripting and cmdlet needs.</span></span> <span data-ttu-id="79eaa-196">键入以下命令，然后按**Enter**。</span><span class="sxs-lookup"><span data-stu-id="79eaa-196">Type the following, and then press **Enter**.</span></span>

   ```
   Add-PswaAuthorizationRule -UserName <domain\user | computer\user> `
      -ComputerName <computer_name> -ConfigurationName <session_configuration_name>
   ```

   - <span data-ttu-id="79eaa-197">在以下示例中，_Contoso_ 域中名为 _JSmith_ 的用户获得访问权限，以管理计算机 _Contoso_214_，并使用名为 _NewAdminsOnly_ 的会话配置。</span><span class="sxs-lookup"><span data-stu-id="79eaa-197">In the following example, a user named _JSmith_ in the _Contoso_ domain is granted access to manage the computer _Contoso_214_, and use a session configuration named _NewAdminsOnly_.</span></span>

   ```powershell
   Add-PswaAuthorizationRule -UserName 'Contoso\JSmith' `
      -ComputerName Contoso_214 -ConfigurationName NewAdminsOnly
   ```

4. <span data-ttu-id="79eaa-198">验证规则是否是通过运行 Get-PswaAuthorizationRule  cmdlet 或 `Test-PswaAuthorizationRule -UserName <domain\user | computer\user> -ComputerName** <computer_name>` 进行创建的。</span><span class="sxs-lookup"><span data-stu-id="79eaa-198">Verify that the rule has been created by running either the **Get-PswaAuthorizationRule** cmdlet, or `Test-PswaAuthorizationRule -UserName <domain\user | computer\user> -ComputerName** <computer_name>`.</span></span>
   <span data-ttu-id="79eaa-199">例如，`Test-PswaAuthorizationRule -UserName Contoso\\JSmith -ComputerName Contoso_214` 。</span><span class="sxs-lookup"><span data-stu-id="79eaa-199">For example, `Test-PswaAuthorizationRule -UserName Contoso\\JSmith -ComputerName Contoso_214`.</span></span>

#### <a name="to-remove-an-authorization-rule"></a><span data-ttu-id="79eaa-200">删除授权规则</span><span class="sxs-lookup"><span data-stu-id="79eaa-200">To remove an authorization rule</span></span>

1. <span data-ttu-id="79eaa-201">如果尚未打开 Windows PowerShell 会话，请参阅本部分中[添加受限的授权规则](#to-add-a-restrictive-authorization-rule)的步骤 1。</span><span class="sxs-lookup"><span data-stu-id="79eaa-201">If a Windows PowerShell session is not already open, see step 1 of [to add a restrictive authorization rule](#to-add-a-restrictive-authorization-rule) in this section.</span></span>

2. <span data-ttu-id="79eaa-202">键入以下内容，然后按 **Enter**，其中的*规则 ID* 代表要删除的规则的唯一 ID 号。</span><span class="sxs-lookup"><span data-stu-id="79eaa-202">Type the following, and then press **Enter**, where *rule ID* represents the unique ID number of the rule that you want to remove.</span></span>

   ```
   Remove-PswaAuthorizationRule -ID <rule ID>
   ```

   <span data-ttu-id="79eaa-203">此外，如果你不知道 ID 号，但知道你想要删除的规则的友好名称，则可获取该规则的名称，通过管道将它传递给 `Remove-PswaAuthorizationRule` cmdlet，从而删除该规则，如以下示例所示：</span><span class="sxs-lookup"><span data-stu-id="79eaa-203">Alternatively, if you do not know the ID number, but know the friendly name of the rule you want to remove, you can get the name of the rule, and pipe it to the `Remove-PswaAuthorizationRule` cmdlet to remove the rule, as shown in the following example:</span></span>

   ```
   Get-PswaAuthorizationRule `
      -RuleName <rule-name> | Remove-PswaAuthorizationRule
   ```

> [!NOTE]
> <span data-ttu-id="79eaa-204">系统不会提示你确认是否要删除特定的授权规则；按下 **Enter**，即可删除该规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-204">You are not prompted to confirm whether you want to delete the specified authorization rule; the rule is deleted when you press **Enter**.</span></span> <span data-ttu-id="79eaa-205">在运行 `Remove-PswaAuthorizationRule` cmdlet 之前，确保你想要删除授权规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-205">Be sure that you want to remove the authorization rule before running the `Remove-PswaAuthorizationRule` cmdlet.</span></span>

#### <a name="other-authorization-rule-scenario-examples"></a><span data-ttu-id="79eaa-206">其他授权规则方案示例</span><span class="sxs-lookup"><span data-stu-id="79eaa-206">Other authorization rule scenario examples</span></span>

<span data-ttu-id="79eaa-207">每个 Windows PowerShell 会话都使用会话配置；如果尚未为会话指定任何会话配置，Windows PowerShell 将使用默认的内置 Windows PowerShell 会话配置（被称为 Microsoft.PowerShell）。</span><span class="sxs-lookup"><span data-stu-id="79eaa-207">Every Windows PowerShell session uses a session configuration; if one is not specified for a session, Windows PowerShell uses the default, built-in Windows PowerShell session configuration, called Microsoft.PowerShell.</span></span> <span data-ttu-id="79eaa-208">默认的会话配置包括计算机上可用的所有 cmdlet。</span><span class="sxs-lookup"><span data-stu-id="79eaa-208">The default session configuration includes all cmdlets that are available on a computer.</span></span> <span data-ttu-id="79eaa-209">管理员可利用受限的运行空间（有限范围内的其最终用户可执行的 cmdlet 和任务）定义会话配置，从而限制对所有计算机的访问权限。</span><span class="sxs-lookup"><span data-stu-id="79eaa-209">Administrators can restrict access to all computers by defining a session configuration with a restricted runspace (a limited range of cmdlets and tasks that their end users could perform).</span></span> <span data-ttu-id="79eaa-210">对于有权访问一台具有所有语言访问权限的计算机或仅可访问 Windows PowerShell 远程管理 cmdlet 的用户，可连接到其他与第一台计算机连接的计算机。</span><span class="sxs-lookup"><span data-stu-id="79eaa-210">A user who is granted access to one computer with either full language access or only the Windows PowerShell remote management cmdlets can connect to other computers that are connected to the first computer.</span></span> <span data-ttu-id="79eaa-211">定义受限的运行空间可阻止用户从其获准许的 Windows PowerShell 运行空间访问其他计算机，从而改善你的 Windows PowerShell Web 访问环境的安全性。</span><span class="sxs-lookup"><span data-stu-id="79eaa-211">Defining a restricted runspace can prevent users from accessing other computers from their allowed Windows PowerShell runspace, and improves the security of your Windows PowerShell Web Access environment.</span></span> <span data-ttu-id="79eaa-212">可（通过使用组策略）将会话配置分配给所有管理员想通过 Windows PowerShell Web 访问进行访问的计算机。</span><span class="sxs-lookup"><span data-stu-id="79eaa-212">The session configuration can be distributed (by using Group Policy) to all computers that administrators want to make accessible through Windows PowerShell Web Access.</span></span> <span data-ttu-id="79eaa-213">有关会话配置的详细信息，请参阅 [about_Session_Configurations](/powershell/module/Microsoft.PowerShell.Core/About/about_session_configurations)。</span><span class="sxs-lookup"><span data-stu-id="79eaa-213">For more information about session configurations, see [about_Session_Configurations](/powershell/module/Microsoft.PowerShell.Core/About/about_session_configurations).</span></span>
<span data-ttu-id="79eaa-214">以下是本方案的一些示例。</span><span class="sxs-lookup"><span data-stu-id="79eaa-214">The following are some examples of this scenario.</span></span>

- <span data-ttu-id="79eaa-215">管理员创建名为 **PswaEndpoint** 的终结点，其中带有受限的运行空间。</span><span class="sxs-lookup"><span data-stu-id="79eaa-215">An administrator creates an endpoint, called **PswaEndpoint**, with a restricted runspace.</span></span> <span data-ttu-id="79eaa-216">然后管理员创建规则 `*,*,PswaEndpoint`，并将终结点分配给其他计算机。</span><span class="sxs-lookup"><span data-stu-id="79eaa-216">Then, the administrator creates a rule, `*,*,PswaEndpoint`, and distributes the endpoint to other computers.</span></span> <span data-ttu-id="79eaa-217">规则可让所有用户访问所有带有终结点 **PswaEndpoint** 的计算机。</span><span class="sxs-lookup"><span data-stu-id="79eaa-217">The rule allows all users to access all computers with the endpoint **PswaEndpoint**.</span></span>
  <span data-ttu-id="79eaa-218">如果这只是在规则集中定义的授权规则，则不能访问不带有终结点的计算机。</span><span class="sxs-lookup"><span data-stu-id="79eaa-218">If this is the only authorization rule defined in the rule set, computers without that endpoint would not be accessible.</span></span>

- <span data-ttu-id="79eaa-219">管理员创建名为 **PswaEndpoint** 的终结点（其中带有受限的运行空间），并希望限制特定用户的访问权限。</span><span class="sxs-lookup"><span data-stu-id="79eaa-219">The administrator created an endpoint with a restricted runspace called **PswaEndpoint**,and wants to restrict access to specific users.</span></span> <span data-ttu-id="79eaa-220">管理员创建一组名为 Level1Support  的用户，并定义以下规则：  Level1Support、\*、PswaEndpoint。</span><span class="sxs-lookup"><span data-stu-id="79eaa-220">The administrator creates a group of users called **Level1Support**, and defines the following rule: **Level1Support,\*,PswaEndpoint**.</span></span> <span data-ttu-id="79eaa-221">规则可让 **Level1Support** 组中的用户访问所有带有 **PswaEndpoint** 配置的计算机。</span><span class="sxs-lookup"><span data-stu-id="79eaa-221">The rule grants any users in the group **Level1Support** access to all computers with the **PswaEndpoint** configuration.</span></span> <span data-ttu-id="79eaa-222">类似地，可限制对特定计算机组合的访问权限。</span><span class="sxs-lookup"><span data-stu-id="79eaa-222">Similarly, access can be restricted to a specific set of computers.</span></span>

- <span data-ttu-id="79eaa-223">有些管理员为某些用户提供的访问权限要比其他用户多。</span><span class="sxs-lookup"><span data-stu-id="79eaa-223">Some administrators provide certain users more access than others.</span></span> <span data-ttu-id="79eaa-224">例如，管理员创建两个用户组，分别是 **Admins** 和 **BasicSupport**。</span><span class="sxs-lookup"><span data-stu-id="79eaa-224">For example, an administrator creates two user groups, **Admins** and **BasicSupport**.</span></span> <span data-ttu-id="79eaa-225">管理员还创建名为 PswaEndpoint 的终结点（其中带有受限的运行空间），并定义以下两项规则  ：**Admins,\*,\*** 和 **BasicSupport,\*,PswaEndpoint**.</span><span class="sxs-lookup"><span data-stu-id="79eaa-225">The administrator also creates an endpoint with a restricted runspace called **PswaEndpoint**, and defines the following two rules: **Admins,\*,\*** and **BasicSupport,\*,PswaEndpoint**.</span></span> <span data-ttu-id="79eaa-226">第一条规则为**Admin**组中的所有用户提供访问所有计算机的权限，第二条规则为**BasicSupport**组中的所有用户仅提供访问那些带有**PswaEndpoint**的计算机的权限。</span><span class="sxs-lookup"><span data-stu-id="79eaa-226">The first rule provides all users in the **Admin** group access to all computers, and the second rule provides all users in the **BasicSupport** group access only to those computers with **PswaEndpoint**.</span></span>

- <span data-ttu-id="79eaa-227">管理员已设置专用测试环境，希望可让所有授权的网络用户通过他们经常访问的网络访问所有计算机，并持有对所有他们经常访问的会话配置的访问权限。</span><span class="sxs-lookup"><span data-stu-id="79eaa-227">An administrator has set up a private test environment, and wants to allow all authorized network users access to all computers on the network to which they typically have access, with access to all session configurations to which they typically have access.</span></span> <span data-ttu-id="79eaa-228">因为这是专用测试环境，管理员创建了不安全的授权规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-228">Because this is a private test environment, the administrator creates an authorization rule that is not secure.</span></span> <span data-ttu-id="79eaa-229">- 管理员运行的 cmdlet `Add-PswaAuthorizationRule * * *`，使用通配符 **\*** 来表示所有用户、所有计算机和所有配置。</span><span class="sxs-lookup"><span data-stu-id="79eaa-229">- The administrator runs the cmdlet `Add-PswaAuthorizationRule * * *`, which uses the wildcard character **\*** to represent all users, all computers, and all configurations.</span></span> <span data-ttu-id="79eaa-230">- 此规则与下列各项等效：`Add-PswaAuthorizationRule -UserName * -ComputerName * -ConfigurationName *`。</span><span class="sxs-lookup"><span data-stu-id="79eaa-230">- This rule is the equivalent of the following: `Add-PswaAuthorizationRule -UserName * -ComputerName * -ConfigurationName *`.</span></span>

  > [!NOTE]
  > <span data-ttu-id="79eaa-231">此规则不建议在安全的环境中使用，它可绕过 Windows PowerShell Web 访问提供的授权规则安全层。</span><span class="sxs-lookup"><span data-stu-id="79eaa-231">This rule is not recommended in a secure environment, and bypasses the authorization rule layer of security provided by Windows PowerShell Web Access.</span></span>

- <span data-ttu-id="79eaa-232">管理员必须允许用户连接到同时包含工作组和域的环境中的目标计算机，其中工作组计算机偶尔用于连接到域中的目标计算机，域中的计算机偶尔用于连接到工作组中的目标计算机。</span><span class="sxs-lookup"><span data-stu-id="79eaa-232">An administrator must allow users to connect to target computers in an environment that includes both workgroups and domains, where workgroup computers are occasionally used to connect to target computers in domains, and computers in domains are occasionally used to connect to target computers in workgroups.</span></span> <span data-ttu-id="79eaa-233">管理员具有工作组中的网关服务器 *PswaServer*，并且目标计算机 *srv1.contoso.com* 位于域中。</span><span class="sxs-lookup"><span data-stu-id="79eaa-233">The administrator has a gateway server, *PswaServer*, in a workgroup; and target computer *srv1.contoso.com* is in a domain.</span></span> <span data-ttu-id="79eaa-234">用户 *Chris* 既是工作组网关服务器又是目标计算机上的授权本地用户。</span><span class="sxs-lookup"><span data-stu-id="79eaa-234">User *Chris* is an authorized local user on both the workgroup gateway server and the target computer.</span></span> <span data-ttu-id="79eaa-235">他在工作组服务器上的用户名为 *chrisLocal*，他在目标计算机上的用户名为 *contoso\\chris*。</span><span class="sxs-lookup"><span data-stu-id="79eaa-235">His user name on the workgroup server is *chrisLocal*; and his user name on the target computer is *contoso\\chris*.</span></span> <span data-ttu-id="79eaa-236">若要授权 Chris 可访问 srv1.contoso.com，管理员会添加以下规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-236">To authorize access to srv1.contoso.com for Chris, the administrator adds the following rule.</span></span>

```powershell
Add-PswaAuthorizationRule -userName PswaServer\chrisLocal `
   -computerName srv1.contoso.com -configurationName Microsoft.PowerShell
```

<span data-ttu-id="79eaa-237">上述规则示例会在网关服务器上对 Chris 进行身份验证，然后授权他可以访问 *srv1*。</span><span class="sxs-lookup"><span data-stu-id="79eaa-237">The preceding rule example authenticates Chris on the gateway server, and then authorizes his access to *srv1*.</span></span> <span data-ttu-id="79eaa-238">在登录页面上，Chris 必须在“**可选连接设置**”区域 (*contoso\\chris*) 中提供第二组凭据。</span><span class="sxs-lookup"><span data-stu-id="79eaa-238">On the sign-in page, Chris must provide a second set of credentials in the **Optional connection settings** area (*contoso\\chris*).</span></span> <span data-ttu-id="79eaa-239">网关服务器使用一组额外的凭据在目标计算机*srv1.contoso.com*上对其进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="79eaa-239">The gateway server uses the additional set of credentials to authenticate him on the target computer, *srv1.contoso.com*.</span></span>

<span data-ttu-id="79eaa-240">在上述情景中，Windows PowerShell Web 访问仅在以下操作已成功且至少一个授权规则允许使用以下操作之后才会建立到目标计算机的成功连接。</span><span class="sxs-lookup"><span data-stu-id="79eaa-240">In the preceding scenario, Windows PowerShell Web Access establishes a successful connection to the target computer only after the following have been successful, and allowed by at least one authorization rule.</span></span>

1. <span data-ttu-id="79eaa-241">工作组网关服务器上的身份验证，方法是向授权规则添加采用 *server_name*\\*user_name* 格式的用户名</span><span class="sxs-lookup"><span data-stu-id="79eaa-241">Authentication on the workgroup gateway server by adding a user name in the format *server_name*\\*user_name* to the authorization rule</span></span>

2. <span data-ttu-id="79eaa-242">目标计算机上的身份验证，方法是使用“可选连接设置”  区域的登录页面中提供的备用凭据</span><span class="sxs-lookup"><span data-stu-id="79eaa-242">Authentication on the target computer by using alternate credentials provided on the sign-in page, in the **Optional connection settings** area</span></span>

   > [!NOTE]
   > <span data-ttu-id="79eaa-243">如果网关和目标计算机位于不同的工作组或域中，则必须在两个工作组计算机之间、两个域之间或工作组和域之间建立信任关系。</span><span class="sxs-lookup"><span data-stu-id="79eaa-243">If gateway and target computers are in different workgroups or domains, a trust relationship must be established between the two workgroup computers, the two domains, or between the workgroup and the domain.</span></span> <span data-ttu-id="79eaa-244">不能使用 Windows PowerShell Web 访问授权规则 cmdlet 配置此关系。</span><span class="sxs-lookup"><span data-stu-id="79eaa-244">This relationship cannot be configured by using Windows PowerShell Web Access authorization rule cmdlets.</span></span> <span data-ttu-id="79eaa-245">授权规则不会定义计算机之间的信任关系，它们仅可授权用户连接到特定目标计算机和会话配置。</span><span class="sxs-lookup"><span data-stu-id="79eaa-245">Authorization rules do not define a trust relationship between computers; they can only authorize users to connect to specific target computers and session configurations.</span></span> <span data-ttu-id="79eaa-246">有关如何配置不同域之间信任关系的详细信息，请参阅[创建域和林信任](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc794775(v=ws.10))。</span><span class="sxs-lookup"><span data-stu-id="79eaa-246">For more information about how to configure a trust relationship between different domains, see [Creating Domain and Forest Trusts](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc794775(v=ws.10)).</span></span>
   > <span data-ttu-id="79eaa-247">有关如何向受信任主机列表中添加工作组计算机的详细信息，请参阅[使用服务器管理器进行远程管理](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd759202(v=ws.11))。</span><span class="sxs-lookup"><span data-stu-id="79eaa-247">For more information about how to add workgroup computers to a trusted hosts list, see [Remote Management with Server Manager](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd759202(v=ws.11)).</span></span>

### <a name="using-a-single-set-of-authorization-rules-for-multiple-sites"></a><span data-ttu-id="79eaa-248">对多个网站使用单一的授权规则集</span><span class="sxs-lookup"><span data-stu-id="79eaa-248">Using a single set of authorization rules for multiple sites</span></span>

<span data-ttu-id="79eaa-249">授权规则存储在 XML 文件中。</span><span class="sxs-lookup"><span data-stu-id="79eaa-249">Authorization rules are stored in an XML file.</span></span> <span data-ttu-id="79eaa-250">默认情况下，XML 文件的路径名称是 `$env:windir\Web\PowershellWebAccess\data\AuthorizationRules.xml`。</span><span class="sxs-lookup"><span data-stu-id="79eaa-250">By default, the path name of the XML file is `$env:windir\Web\PowershellWebAccess\data\AuthorizationRules.xml`.</span></span>

<span data-ttu-id="79eaa-251">授权规则 XML 文件的路径存储在 powwa.config  文件中，可在 `$env:windir\Web\PowershellWebAccess\data` 中找到。</span><span class="sxs-lookup"><span data-stu-id="79eaa-251">The path to the authorization rules XML file is stored in the **powwa.config** file, which is found in `$env:windir\Web\PowershellWebAccess\data`.</span></span> <span data-ttu-id="79eaa-252">管理员可随时将参考路径更改为 **powwa.config** 中的默认路径，以满足首选项或要求。</span><span class="sxs-lookup"><span data-stu-id="79eaa-252">The administrator has the flexibility to change the reference to the default path in **powwa.config** to suit preferences or requirements.</span></span> <span data-ttu-id="79eaa-253">允许管理员更改文件的位置，可让多个 Windows PowerShell Web 访问网关在需要此类配置的情况下，使用相同的授权规则。</span><span class="sxs-lookup"><span data-stu-id="79eaa-253">Allowing the administrator to change the location of the file lets multiple Windows PowerShell Web Access gateways use the same authorization rules, if such a configuration is desired.</span></span>

## <a name="session-management"></a><span data-ttu-id="79eaa-254">会话管理</span><span class="sxs-lookup"><span data-stu-id="79eaa-254">Session management</span></span>

<span data-ttu-id="79eaa-255">默认情况下，Windows PowerShell Web 访问限制一名用户一次访问三个会话。</span><span class="sxs-lookup"><span data-stu-id="79eaa-255">By default, Windows PowerShell Web Access limits a user to three sessions at one time.</span></span> <span data-ttu-id="79eaa-256">可在 IIS 管理器中编辑 Web 应用程序的 web.config 文件，使每名用户可访问不同数目的会话  。</span><span class="sxs-lookup"><span data-stu-id="79eaa-256">You can edit the web application's **web.config** file in IIS Manager to support a different number of sessions per user.</span></span> <span data-ttu-id="79eaa-257">web.config  文件的路径是 `$env:windir\Web\PowerShellWebAccess\wwwroot\Web.config`。</span><span class="sxs-lookup"><span data-stu-id="79eaa-257">The path to the **web.config** file is `$env:windir\Web\PowerShellWebAccess\wwwroot\Web.config`.</span></span>

<span data-ttu-id="79eaa-258">默认情况下，如果编辑了任何设置，则会配置 IIS Web 服务器，以重启应用程序池。</span><span class="sxs-lookup"><span data-stu-id="79eaa-258">By default, IIS Web Server is configured to restart the application pool if any settings are edited.</span></span> <span data-ttu-id="79eaa-259">例如，如果对 **web.config** 文件进行更改，则重新启动应用程序池。</span><span class="sxs-lookup"><span data-stu-id="79eaa-259">For example, the application pool is restarted if changes are made to the **web.config** file.</span></span> <span data-ttu-id="79eaa-260">由于 Windows PowerShell Web 访问  使用内存中的会话状态，因此重启应用程序池时，登录到 Windows PowerShell Web 访问  会话的用户将错过其会话。</span><span class="sxs-lookup"><span data-stu-id="79eaa-260">>Because **Windows PowerShell Web Access** uses in-memory session states, >users signed in to **Windows PowerShell Web Access** sessions lose their sessions when the application pool is restarted.</span></span>

### <a name="setting-default-parameters-on-the-sign-in-page"></a><span data-ttu-id="79eaa-261">在登录页上设置默认参数</span><span class="sxs-lookup"><span data-stu-id="79eaa-261">Setting default parameters on the sign-in page</span></span>

<span data-ttu-id="79eaa-262">如果您的 Windows PowerShell Web 访问网关在 Windows Server 2012 R2 上运行，您可以配置在 Windows PowerShell Web 访问登录页上显示的设置的默认值。</span><span class="sxs-lookup"><span data-stu-id="79eaa-262">If your Windows PowerShell Web Access gateway is running on Windows Server 2012 R2, you can configure default values for the settings that are displayed on the Windows PowerShell Web Access sign-in page.</span></span> <span data-ttu-id="79eaa-263">可以配置上一段所述的 **web.config** 文件中的值。</span><span class="sxs-lookup"><span data-stu-id="79eaa-263">You can configure values in the **web.config** file that is described in the preceding paragraph.</span></span> <span data-ttu-id="79eaa-264">登录页设置的默认值位于 web.config 文件的 **appSettings** 部分中；以下是 **appSettings** 部分的示例。</span><span class="sxs-lookup"><span data-stu-id="79eaa-264">Default values for the sign-in page settings are found in the **appSettings** section of the web.config file; the following is an example of the **appSettings** section.</span></span> <span data-ttu-id="79eaa-265">其中许多设置的有效值与 Windows PowerShell 中 [New-PSSession](/powershell/module/Microsoft.PowerShell.Core/New-PSSession) cmdlet 的相应参数的有效值相同。</span><span class="sxs-lookup"><span data-stu-id="79eaa-265">Valid values for many of these settings are the same as those for the corresponding parameters of the [New-PSSession](/powershell/module/Microsoft.PowerShell.Core/New-PSSession) cmdlet in Windows PowerShell.</span></span>

<span data-ttu-id="79eaa-266">例如，`defaultApplicationName` 键（如以下代码块中所示）是目标计算机上 $PSSessionApplicationName 首选项变量的值  。</span><span class="sxs-lookup"><span data-stu-id="79eaa-266">For example, the `defaultApplicationName` key, as shown in the following code block, is the value of the **$PSSessionApplicationName** preference variable on the target computer.</span></span>

```xml
  <appSettings>
      <add key="maxSessionsAllowedPerUser" value="3"/>
      <add key="defaultPortNumber" value="5985"/>
      <add key="defaultSSLPortNumber" value="5986"/>
      <add key="defaultApplicationName" value="WSMAN"/>
      <add key="defaultUseSslSelection" value="0"/>
      <add key="defaultAuthenticationType" value="0"/>
      <add key="defaultAllowRedirection" value="0"/>
      <add key="defaultConfigurationName" value="Microsoft.PowerShell"/>
  </appSettings>
```

### <a name="time-outs-and-unplanned-disconnections"></a><span data-ttu-id="79eaa-267">超时和计划外断开连接</span><span class="sxs-lookup"><span data-stu-id="79eaa-267">Time-outs and unplanned disconnections</span></span>

<span data-ttu-id="79eaa-268">Windows PowerShell Web 访问会话超时。在 Windows Server 2012 上运行的 Windows PowerShell Web 访问中，会话停止活动 15 分钟后，系统会向登录的用户发出超时消息。</span><span class="sxs-lookup"><span data-stu-id="79eaa-268">Windows PowerShell Web Access sessions time out. In Windows PowerShell Web Access running on Windows Server 2012, A time-out message is displayed to signed-in users after 15 minutes of session inactivity.</span></span> <span data-ttu-id="79eaa-269">如果用户在超时信息显示后五分钟内无任何回应，则会话结束，用户被注销。你可以在 IIS 管理器的网站设置中，更改会话的超时时间。</span><span class="sxs-lookup"><span data-stu-id="79eaa-269">If the user does not respond within five minutes after the time-out message is displayed, the session is ended, and the user is signed out. You can change time-out periods for sessions in the website settings in IIS Manager.</span></span>

<span data-ttu-id="79eaa-270">在 Windows Server 2012 R2 上运行的 Windows PowerShell Web 访问中，会话停止活动 20 分钟后，会话默认超时。</span><span class="sxs-lookup"><span data-stu-id="79eaa-270">In Windows PowerShell Web Access running on Windows Server 2012 R2, sessions time out, by default, after 20 minutes of inactivity.</span></span> <span data-ttu-id="79eaa-271">如果用户从基于 Web 的控制台中的会话断开连接是由于网络错误或其他计划外关机或故障，而不是因为他们自己关闭了会话，Windows PowerShell Web 访问会话将继续运行并连接到目标计算机，直到客户端的超时期结束。</span><span class="sxs-lookup"><span data-stu-id="79eaa-271">If users are disconnected from sessions in the web-based console because of network errors or other unplanned shutdowns or failures, and not because they have closed the sessions themselves, the Windows PowerShell Web Access sessions continue to run, connected to target computers, until the time-out period on the client side lapses.</span></span> <span data-ttu-id="79eaa-272">会话在默认的 20 分钟或网关管理员指定的超时期（以时间较短者为准）后断开连接。</span><span class="sxs-lookup"><span data-stu-id="79eaa-272">The session is disconnected after either the default 20 minutes, or after the time-out period specified by the gateway administrator, whichever is shorter.</span></span>

<span data-ttu-id="79eaa-273">如果网关服务器正在运行 Windows Server 2012 R2，Windows PowerShell Web 访问将允许用户稍后重新连接到已保存的会话，但是，如果是网络错误、计划外关机或其他故障导致会话断开连接，用户需在网关管理员指定的超时期过后，才能查看或重新连接到已保存的会话。</span><span class="sxs-lookup"><span data-stu-id="79eaa-273">If the gateway server is running Windows Server 2012 R2, Windows PowerShell Web Access lets users reconnect to saved sessions at a later time, but when network errors, unplanned shutdowns, or other failures disconnect sessions, users cannot see or reconnect to saved sessions until after the time-out period specified by the gateway administrator has lapsed.</span></span>

## <a name="see-also"></a><span data-ttu-id="79eaa-274">另请参阅</span><span class="sxs-lookup"><span data-stu-id="79eaa-274">See Also</span></span>

<span data-ttu-id="79eaa-275">[安装和使用 Windows PowerShell Web 访问](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831611(v=ws.11))</span><span class="sxs-lookup"><span data-stu-id="79eaa-275">[Install and Use Windows PowerShell Web Access](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831611(v=ws.11))</span></span>

[<span data-ttu-id="79eaa-276">about_Session_Configurations</span><span class="sxs-lookup"><span data-stu-id="79eaa-276">about_Session_Configurations</span></span>](/powershell/module/microsoft.powershell.core/about/about_Session_Configurations)

[<span data-ttu-id="79eaa-277">Windows PowerShell Web 访问 Cmdlet</span><span class="sxs-lookup"><span data-stu-id="79eaa-277">Windows PowerShell Web Access Cmdlets</span></span>](/powershell/module/powershellwebaccess/?view=winserver2012r2-ps)
